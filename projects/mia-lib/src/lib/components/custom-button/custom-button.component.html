<ng-container [ngSwitch]="variant">
  <button *ngSwitchCase="'basic'" mat-button [disabled]="disabled || loading">
    <ng-container *ngTemplateOutlet="buttonTemplate"></ng-container>
  </button>
  <button
    *ngSwitchCase="'flat'"
    mat-flat-button
    color="primary"
    [disabled]="disabled || loading"
  >
    <ng-container *ngTemplateOutlet="buttonTemplate"></ng-container>
  </button>
  <button
    *ngSwitchCase="'outline'"
    mat-stroked-button
    [disabled]="disabled || loading"
  >
    <ng-container *ngTemplateOutlet="buttonTemplate"></ng-container>
  </button>
</ng-container>

<!-- base template -->
<ng-template #buttonTemplate>
  <!-- default label -->
  <ng-container *ngIf="!loading; else loadingTemplate">
    <ng-content></ng-content>
  </ng-container>
  <ng-template #loadingTemplate>
    <!-- passed template while loading -->
    <ng-container
      *ngTemplateOutlet="icon?.template || defaultLoader"
    ></ng-container>
    <ng-template #defaultLoader>
      <mat-icon>
        <mat-spinner diameter="20" color="accent"> </mat-spinner>
      </mat-icon>
    </ng-template>
  </ng-template>
</ng-template>
