<mat-form-field [appearance]="appearance">
  <mat-label>{{ placeholder }}</mat-label>
  <mat-select [sortComparator]="sortFunc" [formControl]="control">
    <!-- Search input -->
    <mat-optgroup class="d-block my-2">
      <custom-input
        class="width-100"
        [clearFilter]="true"
        [appearance]="'legacy'"
        [formControl]="filterControl"
        [placeholder]="searchPlaceholder"
      >
      </custom-input>
      <mat-option [disabled]="true" [style.display]="'none'"></mat-option>
    </mat-optgroup>

    <!-- Options -->
    <ng-container *ngIf="items | async as retrievedItems; else waitingResponse">
      <ng-container *ngFor="let item of retrievedItems">
        <ng-container *ngIf="bindKeyValue; else basicTmpl">
          <mat-option [value]="item[bindValueKey]">
            {{ item[bindLabelKey] | titlecase }}
          </mat-option>
        </ng-container>

        <ng-template #basicTmpl>
          <mat-option [value]="item">{{ item | titlecase }}</mat-option>
        </ng-template>
      </ng-container>

      <ng-container *ngIf="retrievedItems.length === 0">
        <div class="p-2">No items found.</div>
      </ng-container>
    </ng-container>

    <ng-template #waitingResponse>
      <mat-option [disabled]="true">Please wait...</mat-option>
    </ng-template>
  </mat-select>
</mat-form-field>
