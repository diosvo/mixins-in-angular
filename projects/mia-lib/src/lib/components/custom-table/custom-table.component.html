<main class="bg-white bd-auto m-2 px-3 py-2">
  <ng-content select="[header]"></ng-content>

  <!-- Table -->
  <div class="custom-table">
    <mat-table
      [dataSource]="source"
      [trackBy]="trackByIdx"
      matSort
      matSortDisableClear
      [matSortActive]="defaultSortColumn"
      [matSortDirection]="defaultSortDirection"
    >
      <ng-container
        *ngFor="let column of columns; let idx = index"
        [matColumnDef]="column.key"
      >
        <ng-container
          *ngIf="column.key === 'select'; then checkbox; else noCheckbox"
        ></ng-container>

        <!-- Checkbox -->
        <ng-template #checkbox>
          <mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              (change)="$event ? masterToggle() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()"
            >
            </mat-checkbox>
          </mat-header-cell>
          <mat-cell *matCellDef="let row">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              (change)="$event ? selection.toggle(row) : null; rowSelect()"
              [checked]="selection.isSelected(row)"
            >
            </mat-checkbox>
          </mat-cell>
        </ng-template>

        <!-- No Checkbox -->
        <ng-template #noCheckbox>
          <mat-header-cell
            *matHeaderCellDef
            disableClear
            mat-sort-header
            [disabled]="column.disableSorting"
          >
            <span class="truncate-cell">
              {{ column?.header || column?.key | uppercase }}
            </span>
          </mat-header-cell>
          <mat-cell *matCellDef="let row; let idx = index">
            <span class="truncate-cell">
              <ng-container
                [ngTemplateOutlet]="columnTemplates[column.key] || noTemplates"
                [ngTemplateOutletContext]="{ $implicit: row }"
              ></ng-container>
            </span>
            <ng-template #noTemplates>
              <span class="truncate-cell">{{ row[column.key] }}</span>
            </ng-template>
          </mat-cell>
        </ng-template>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayColumns"></mat-row>

      <!-- Loading spinner -->
      <div *matNoDataRow>
        <div class="d-flex jc-center ai-center my-2">
          <mat-spinner [diameter]="50"></mat-spinner>
        </div>
      </div>
    </mat-table>
  </div>

  <!-- Pagination -->
  <div *ngIf="pageable" [class.custom-pagination]="pageable">
    <mat-paginator
      [pageSizeOptions]="pageSizeOptions"
      [showFirstLastButtons]="showFirstLastButtons"
    ></mat-paginator>
  </div>
</main>
