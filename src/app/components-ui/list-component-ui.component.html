<ng-container *ngIf="errorMessage$ | async as message; else noError">
  <alert-message type="error"> {{ message }} </alert-message>
</ng-container>

<ng-template #noError>
  <ng-template #loadingTmpl>
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </ng-template>

  <!-- Search -->
  <ng-container *ngIf="filteredData$ | async as filteredData; else loadingTmpl">
    <mat-accordion>
      <mat-expansion-panel>
        <!-- Header -->
        <mat-expansion-panel-header>
          <mat-panel-title class="ai-center">
            Represent distinct UI elements.
          </mat-panel-title>
          <mat-panel-description class="jc-flex-end">
            <button
              mat-icon-button
              *ngIf="clearAllIconActive()"
              (click)="cleanFilters()"
              matTooltip="Clear All Filters"
              matTooltipPosition="left"
            >
              <mat-icon>clear_all</mat-icon>
            </button>
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- Content -->
        <ng-template matExpansionPanelContent>
          <form
            [formGroup]="componentsForm"
            class="panel-container d-flex gap-1"
          >
            <custom-select
              [items]="groupList"
              placeholder="Group"
              formControlName="group"
              searchPlaceholder="Find the group..."
            ></custom-select>

            <mat-form-field class="width-100">
              <mat-label>What are you looking for today...</mat-label>
              <input matInput autocomplete="off" formControlName="query" />
              <button
                matSuffix
                mat-icon-button
                *ngIf="query.value !== ''"
                matTooltip="Clear"
                (click)="cleanQuery()"
              >
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </form>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>

    <ng-container *ngIf="filteredData.length > 0; else notFound">
      <card-item [data]="filteredData"></card-item>
    </ng-container>

    <ng-template #notFound>
      <div class="text-center my-2">
        <span>No results match. The active filters are hiding all items.</span>
        <br class="my-1" />
        <a
          (click)="cleanFilters()"
          class="text-light-blue text-deco-underline cursor-pointer"
        >
          Reset filters.
        </a>
      </div>
    </ng-template>
  </ng-container>
</ng-template>
