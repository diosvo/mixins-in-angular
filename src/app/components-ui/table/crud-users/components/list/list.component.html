<ng-template #selectionTpl let-users>
  <div i18n>This will delete selected users. Are you sure?</div>
  <ul>
    <li *ngFor="let user of users">#{{ user.id }} {{ user.name }}</li>
  </ul>
</ng-template>

<ng-container *ngIf="state$ | async as state">
  <alert-message *ngIf="state.error" type="error">
    {{ state.error }}
  </alert-message>

  <custom-table
    *ngIf="state.data | filter: query.value as filtered_data"
    [data]="filtered_data"
    [columns]="columns"
    [highlight]="query.value"
    [defaultSortColumn]="'name'"
    [enableCheckbox]="true"
    (selectedRows)="selection = $event"
    [enableExpansion]="true"
  >
    <div header class="d-flex ai-baseline jc-between">
      <h2>List Users</h2>
      <custom-button
        variant="flat"
        (click)="onBulk({})"
        [disabled]="state.loading"
        i18n
      >
        Create User
      </custom-button>
    </div>

    <div filters>
      <ng-container *ngIf="selection.length > 0; else searchingTemplate">
        <section
          class="bg-primary text-white d-flex ai-center jc-between pl-2 py-1"
        >
          <div *ngIf="selection.length > 0" class="flex-1" i18n>
            {{ selection.length }}
            {selection.length, plural, =1 {user} other {users} } selected
          </div>

          <ng-container>
            <custom-button variant="basic" (click)="onDelete(selection)" i18n>
              Delete
            </custom-button>
            <span>|</span>
            <custom-button variant="basic" (click)="onCancel()" i18n>
              Cancel
            </custom-button>
          </ng-container>
        </section>
      </ng-container>

      <!-- Basic template -->
      <ng-template #searchingTemplate>
        <custom-input
          filters
          *ngIf="state.data.length > 0"
          label="search"
          [clearFilter]="true"
          [formControl]="query"
          placeholder="type to search..."
        >
        </custom-input>
      </ng-template>
    </div>

    <custom-column columnName="actions">
      <ng-template let-user let-index="index">
        <custom-button
          variant="icon"
          tooltip="Edit"
          iconClass="f-16 text-action-icon-hover"
          [class.visibility-hidden]="selection.length > 1"
          [disabled]="state.loading"
          (click)="onBulk(user)"
        >
          <ng-container icon>edit</ng-container>
        </custom-button>
        <custom-button
          variant="icon"
          tooltip="Delete"
          iconClass="f-16 text-action-icon-hover"
          [class.visibility-hidden]="selection.length > 1"
          [disabled]="state.loading"
          (click)="onDelete([user])"
        >
          <ng-container icon>delete_outline</ng-container>
        </custom-button>
      </ng-template>
    </custom-column>

    <ng-template #expandedDetail let-user>
      <div class="d-flex width-100">
        <div [style.flex.%]="15">
          <i class="mdi mdi-contact-phone mr-1"></i>
          <span class="f-12">{{ user.phone }}</span>
        </div>
        <div [style.flex.%]="35">
          <i class="mdi mdi-person-pin-circle mr-1"></i>
          <span class="f-12">
            {{ user.address.suite }} {{ user.address.street }}
            {{ user.address.city }} {{ user.address.zipcode }}
          </span>
        </div>
        <div [style.flex.%]="35">
          <i class="mdi-outlined mdi-account-balance mr-1"></i>
          <span class="f-12">
            {{ user.company.name }} / {{ user.company.catchPhrase }}
          </span>
        </div>
        <div [style.flex.%]="15">
          <i class="mdi-round mdi-public mr-1"></i>
          <span class="f-12">{{ user.website }}</span>
        </div>
      </div>
    </ng-template>

    <ng-container noData>
      <ng-container *ngIf="state.loading; else getData">
        <div class="text-center m-2">Loading ...</div>
      </ng-container>
      <ng-template #getData>
        <ng-container *ngIf="state.data.length > 0; else noConfigured">
          <no-results (resetFilters)="query.setValue('')"></no-results>
        </ng-container>
        <ng-template #noConfigured>
          <div class="text-center m-2">No users have been configured.</div>
        </ng-template>
      </ng-template>
    </ng-container>
  </custom-table>
</ng-container>
