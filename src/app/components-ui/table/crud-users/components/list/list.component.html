<ng-container *ngIf="state$ | async as state">
  <mat-progress-bar
    *ngIf="state.loading"
    mode="indeterminate"
  ></mat-progress-bar>

  <alert-message *ngIf="state.message" type="error">
    {{ state.message }}
  </alert-message>

  <custom-table
    *ngIf="state.data"
    [data]="state.data | filter: query.value"
    [columns]="columns"
    [defaultSortColumn]="'name'"
  >
    <div header class="d-flex ai-baseline jc-between">
      <h2>List Users</h2>
      <custom-button [routerLink]="['create']"> Create User </custom-button>
    </div>

    <div filters>
      <custom-input
        class="flex-1"
        label="search"
        [clearFilter]="true"
        [formControl]="query"
      >
      </custom-input>
    </div>

    <custom-column columnName="email">
      <ng-template let-user>
        {{ user.email | lowercase }}
      </ng-template>
    </custom-column>

    <custom-column columnName="actions">
      <ng-template let-user let-index="index">
        <custom-button variant="icon" [routerLink]="[user.id]">
          <ng-container icon>edit</ng-container>
        </custom-button>
        <custom-button variant="icon" (click)="openConfirmDialog(user)">
          <ng-container icon>delete_outline</ng-container>
        </custom-button>
      </ng-template>
    </custom-column>
  </custom-table>
</ng-container>
