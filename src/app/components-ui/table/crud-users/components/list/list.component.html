<ng-template #selectionTpl let-users>
  <div>This will delete selected users. Are you sure?</div>
  <ul>
    <li *ngFor="let user of users">#{{ user.id }} {{ user.name }}</li>
  </ul>
</ng-template>

<ng-container *ngIf="state$ | async as state">
  <alert-message *ngIf="state.error" type="error">
    {{ state.error }}
  </alert-message>

  <custom-table
    *ngIf="state.data | filter: query.value as filtered_data"
    [data]="filtered_data"
    [columns]="columns"
    [highlight]="query.value"
    [defaultSortColumn]="'name'"
    [enableCheckbox]="true"
    (selectedRows)="selection = $event"
  >
    <div header class="d-flex ai-baseline jc-between">
      <h2>List Users</h2>
      <custom-button variant="flat" (click)="onBulk({})">
        Create User
      </custom-button>
    </div>

    <div filters class="d-flex ai-baseline jc-between">
      <custom-input
        filters
        label="search"
        [clearFilter]="true"
        [formControl]="query"
        *ngIf="state.data.length > 1"
      >
      </custom-input>
      <div class="flex-1"></div>
      <ng-container *ngIf="selection.length > 0">
        {{ selection.length }}
        {selection.length, plural, =1 {user} other {users} } selected
      </ng-container>
      <custom-button
        class="ml-1"
        variant="outline"
        [disabled]="selection.length < 1"
        (click)="onDelete(selection)"
      >
        Delete selected users
      </custom-button>
    </div>

    <custom-column columnName="actions">
      <ng-template let-user let-index="index">
        <custom-button
          variant="icon"
          tooltip="Edit"
          iconClass="f-16"
          [class.visibility-hidden]="selection.length > 1"
          [disabled]="state.loading"
          (click)="onBulk(user)"
        >
          <ng-container icon>edit</ng-container>
        </custom-button>
        <custom-button
          variant="icon"
          tooltip="Delete"
          iconClass="f-16"
          [class.visibility-hidden]="selection.length > 1"
          [disabled]="state.loading"
          (click)="onDelete([user])"
        >
          <ng-container icon>delete_outline</ng-container>
        </custom-button>
      </ng-template>
    </custom-column>

    <ng-container noData>
      <ng-container *ngIf="state.loading; else getData">
        <div class="text-center m-2">Loading ...</div>
      </ng-container>
      <ng-template #getData>
        <ng-container *ngIf="state.data.length > 1; else noConfigured">
          <no-results (resetFilters)="query.setValue('')"></no-results>
        </ng-container>
        <ng-template #noConfigured>
          <div class="text-center m-2">No users have been configured.</div>
        </ng-template>
      </ng-template>
    </ng-container>
  </custom-table>
</ng-container>
