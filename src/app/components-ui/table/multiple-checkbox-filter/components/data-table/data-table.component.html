<ng-container *ngIf="state$ | async as state">
  <alert-message *ngIf="state.message" type="error">
    {{ state.message }}
  </alert-message>

  <custom-table
    [data]="state.data"
    [length]="1000"
    [columns]="columns"
    [defaultSortColumn]="'created_at'"
    [pageSizeOptions]="[30]"
    [showFirstLastButtons]="true"
    (pageChanges)="pageChanges($event)"
    [style]="{ 'max-height': '300px' }"
  >
    <h2 header>Github Issues</h2>

    <form filters [formGroup]="form">
      <custom-select
        placeholder="State"
        formControlName="states"
        [items]="states"
        [disabled]="state.loading"
        searchPlaceholder="Search"
      ></custom-select>

      <custom-select
        placeholder="Author"
        formControlName="authors"
        [items]="authors"
        [disabled]="state.loading"
        searchPlaceholder="Search"
      ></custom-select>

      <custom-input
        class="flex-1"
        label="search"
        [clearFilter]="true"
        formControlName="query"
        placeholder="Find an issue..."
      >
      </custom-input>
    </form>

    <custom-column columnName="created_at">
      <ng-template let-issue>{{ issue.created_at | date }}</ng-template>
    </custom-column>

    <custom-column columnName="number">
      <ng-template let-issue>
        <a
          target="_blank"
          [href]="issue.html_url"
          rel="noopener noreferrer"
          class="cursor-pointer text-deco-none text-black text-hover-dark-blue"
        >
          {{ issue.number }}
        </a>
      </ng-template>
    </custom-column>

    <custom-column columnName="state">
      <ng-template let-issue>
        <span
          class="chip-spacing f-13"
          [class]="{
            'chip-success': issue.state === 'open',
            'chip-error': issue.state === 'closed'
          }"
        >
          {{ issue.state }}
        </span>
      </ng-template>
    </custom-column>

    <ng-container noData>
      <mat-spinner *ngIf="state.loading; else notFound" diameter="50">
      </mat-spinner>
      <ng-template #notFound>
        <span>No results match. The active filters are hiding all items.</span>
        <a
          (click)="form.reset()"
          class="text-light-blue text-deco-underline cursor-pointer"
        >
          Reset filters
        </a>
      </ng-template>
    </ng-container>
  </custom-table>
</ng-container>
